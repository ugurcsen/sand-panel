package docker

import (
	"bytes"
	"io"
	"os"
	"testing"
)

func TestBuildYaml(t *testing.T) {
	tf, err := os.CreateTemp("", "test")
	if err != nil {
		t.Fatal(err)
	}
	defer os.Remove(tf.Name())

	if err = composeYamlBuilder(testCollection, tf); err != nil {
		t.Fatal(err)
	}
	tf.Seek(0, 0)
	a, err := io.ReadAll(tf)
	if err != nil {
		t.Fatal(err)
	}
	cmpValue := []byte{118, 101, 114, 115, 105, 111, 110, 58, 32, 34, 51, 46, 55, 34, 10, 115, 101, 114, 118, 105, 99, 101, 115, 58, 10, 32, 32, 32, 32, 116, 101, 115, 116, 58, 10, 32, 32, 32, 32, 32, 32, 32, 32, 105, 109, 97, 103, 101, 58, 32, 110, 103, 105, 110, 120, 10, 32, 32, 32, 32, 32, 32, 32, 32, 108, 97, 98, 101, 108, 115, 58, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 116, 114, 97, 101, 102, 105, 107, 46, 101, 110, 97, 98, 108, 101, 58, 32, 34, 116, 114, 117, 101, 34, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 116, 114, 97, 101, 102, 105, 107, 46, 104, 116, 116, 112, 46, 114, 111, 117, 116, 101, 114, 115, 46, 116, 101, 115, 116, 46, 114, 117, 108, 101, 58, 32, 72, 111, 115, 116, 40, 96, 116, 101, 115, 116, 49, 46, 108, 111, 99, 97, 108, 96, 41, 32, 124, 124, 32, 72, 111, 115, 116, 40, 96, 116, 101, 115, 116, 50, 46, 108, 111, 99, 97, 108, 96, 41, 10, 32, 32, 32, 32, 32, 32, 32, 32, 110, 101, 116, 119, 111, 114, 107, 115, 58, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 45, 32, 116, 114, 97, 102, 101, 105, 107, 10, 32, 32, 32, 32, 32, 32, 32, 32, 114, 117, 110, 116, 105, 109, 101, 58, 32, 114, 117, 110, 115, 99, 10, 110, 101, 116, 119, 111, 114, 107, 115, 58, 10, 32, 32, 32, 32, 116, 114, 97, 102, 101, 105, 107, 58, 10, 32, 32, 32, 32, 32, 32, 32, 32, 110, 97, 109, 101, 58, 32, 116, 114, 97, 102, 101, 105, 107, 110, 101, 116, 10, 32, 32, 32, 32, 32, 32, 32, 32, 101, 120, 116, 101, 114, 110, 97, 108, 58, 32, 116, 114, 117, 101, 10}
	if bytes.Compare(a, cmpValue) != 0 {
		t.Error("yaml not equal")
	}
	tf.Close()
}
